<view class="container">
  <!-- Header -->
  <view class="header">
    <view class="header-icon">ğŸ›ï¸</view>
    <view class="header-text">
      <text class="header-title">èˆ†å›¾ä»Šæ˜”</text>
      <text class="header-subtitle">å¤ä»Šåœ°åå¯¹ç…§ Â· æ¢ç´¢åƒå¹´åœ°ç†å˜è¿</text>
    </view>
  </view>

  <!-- æœç´¢åŒºåŸŸ -->
  <view class="search-section">
    <view class="search-box">
      <text class="search-icon">ğŸ”</text>
      <input
        class="search-input"
        placeholder="è¾“å…¥å¤ä»£åœ°åï¼Œå¦‚ï¼šé•¿å®‰ã€ä¸´å®‰â€¦"
        placeholder-class="placeholder"
        value="{{query}}"
        bindinput="onInput"
        bindconfirm="onSearch"
        confirm-type="search"
      />
      <view class="search-btn {{loading ? 'loading' : ''}}" bindtap="onSearch">
        <text wx:if="{{!loading}}">æŸ¥è¯¢</text>
        <view wx:else class="loading-dots">
          <view class="dot"></view>
          <view class="dot"></view>
          <view class="dot"></view>
        </view>
      </view>
    </view>

    <!-- å¿«æ·æ ‡ç­¾ -->
    <view class="tags">
      <view
        class="tag"
        wx:for="{{examplePlaces}}"
        wx:key="name"
        bindtap="onTagTap"
        data-name="{{item.name}}"
      >
        <text>{{item.emoji}}{{item.name}}</text>
      </view>
    </view>
  </view>

  <!-- é”™è¯¯æç¤º -->
  <view class="error-box" wx:if="{{error}}">
    <text>âš ï¸ {{error}}</text>
  </view>

  <!-- åœ°å›¾é¢„è§ˆï¼ˆæœ‰ç»“æœæ—¶æ˜¾ç¤ºï¼‰ -->
  <view class="map-preview-section" wx:if="{{results.length > 0}}">
    <view class="section-header">
      <view class="section-title-row">
        <text class="section-icon">ğŸ—ºï¸</text>
        <text class="section-title-text">åœ°å›¾é¢„è§ˆ</text>
      </view>
      <view class="map-fullscreen-btn" bindtap="onOpenFullMap">
        <text>å…¨å±æŸ¥çœ‹</text>
      </view>
    </view>
    <view class="map-wrapper">
      <map
        id="previewMap"
        class="preview-map"
        latitude="{{mapCenter.latitude}}"
        longitude="{{mapCenter.longitude}}"
        scale="{{mapScale}}"
        markers="{{markers}}"
        show-compass="{{true}}"
        enable-zoom="{{true}}"
        enable-scroll="{{true}}"
      />
    </view>
  </view>

  <!-- ç»“æœåˆ—è¡¨ -->
  <view class="results" wx:if="{{results.length > 0}}">
    <view class="section-header">
      <view class="section-title-row">
        <text class="section-icon">ğŸ“œ</text>
        <text class="section-title-text">æŸ¥è¯¢è®°å½•</text>
      </view>
      <view class="result-count">
        <text>{{results.length}}æ¡</text>
      </view>
    </view>

    <view
      class="result-card {{activeIndex === index ? 'active' : ''}}"
      wx:for="{{results}}"
      wx:key="index"
      bindtap="onResultTap"
      data-index="{{index}}"
    >
      <view class="card-header">
        <view class="card-names">
          <text class="ancient-name">{{item.ancient_name}}</text>
          <text class="arrow">â†’</text>
          <text class="modern-name">{{item.modern_name}}</text>
        </view>
        <view class="card-actions">
          <view class="card-map-btn" catchtap="onLocateOnMap" data-index="{{index}}">
            <text>ğŸ—ºï¸</text>
          </view>
          <view class="card-nav" catchtap="onNavigate" data-index="{{index}}">
            <text>ğŸ“å¯¼èˆª</text>
          </view>
        </view>
      </view>

      <view class="card-info">
        <text class="info-location">ğŸ“Œ {{item.province}} Â· {{item.latitude}}Â°N, {{item.longitude}}Â°E</text>
      </view>

      <view class="card-desc" wx:if="{{activeIndex === index}}">
        <text class="desc-text">{{item.description}}</text>
        <view class="dynasty-tag">
          <text>ğŸ“œ {{item.dynasty_info}}</text>
        </view>
      </view>

      <view class="card-hint" wx:if="{{activeIndex !== index}}">
        <text>ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…</text>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty" wx:if="{{results.length === 0 && !loading}}">
    <view class="empty-icons">
      <text class="empty-icon-main">ğŸ›ï¸</text>
      <text class="empty-icon-star">âœ¦</text>
      <text class="empty-icon-map">ğŸ—ºï¸</text>
    </view>
    <text class="empty-title">æ¢ç´¢å¤ä»Šåœ°å</text>
    <text class="empty-desc">æœç´¢å¤ä»£åœ°åï¼Œå‘ç°è·¨è¶Šåƒå¹´çš„åœ°ç†å˜è¿ä¸å†å²è®°å¿†</text>
    <view class="empty-examples">
      <text>é•¿å®‰ Â· ä¸´å®‰ Â· é‡‘é™µ Â· æ±´æ¢</text>
    </view>
  </view>

  <!-- Loading éª¨æ¶å± -->
  <view class="skeleton" wx:if="{{loading && results.length === 0}}">
    <view class="skeleton-card">
      <view class="skeleton-line long shimmer"></view>
      <view class="skeleton-line medium shimmer"></view>
      <view class="skeleton-line short shimmer"></view>
    </view>
  </view>
</view>
