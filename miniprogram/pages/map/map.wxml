<view class="map-page">
  <!-- å…¨å±åœ°å›¾ -->
  <map
    id="fullMap"
    class="full-map"
    latitude="{{mapCenter.latitude}}"
    longitude="{{mapCenter.longitude}}"
    scale="{{mapScale}}"
    markers="{{markers}}"
    show-compass="{{true}}"
    show-scale="{{true}}"
    enable-zoom="{{true}}"
    enable-scroll="{{true}}"
    enable-rotate="{{true}}"
    enable-3D="{{true}}"
    bindmarkertap="onMarkerTap"
  />

  <!-- åº•éƒ¨ä¿¡æ¯å¡ç‰‡ -->
  <view class="bottom-panel {{activeResult ? 'show' : ''}}">
    <view class="panel-handle" bindtap="onClosePanel">
      <view class="handle-bar"></view>
    </view>

    <view class="panel-content" wx:if="{{activeResult}}">
      <view class="panel-header">
        <view class="panel-names">
          <text class="panel-ancient">{{activeResult.ancient_name}}</text>
          <text class="panel-arrow">â†’</text>
          <text class="panel-modern">{{activeResult.modern_name}}</text>
        </view>
        <view class="panel-nav-btn" bindtap="onNavigate">
          <text>ğŸ“ å¯¼èˆª</text>
        </view>
      </view>

      <view class="panel-info">
        <text class="panel-location">ğŸ“Œ {{activeResult.province}} Â· {{activeResult.latitude}}Â°N, {{activeResult.longitude}}Â°E</text>
      </view>

      <view class="panel-desc">
        <text class="panel-desc-text">{{activeResult.description}}</text>
      </view>

      <view class="panel-dynasty">
        <text>ğŸ“œ {{activeResult.dynasty_info}}</text>
      </view>
    </view>
  </view>

  <!-- åœ°ç‚¹åˆ—è¡¨æŒ‰é’® -->
  <view class="list-toggle" bindtap="onToggleList">
    <text>ğŸ“‹ {{results.length}}</text>
  </view>

  <!-- åœ°ç‚¹åˆ—è¡¨å¼¹å‡ºå±‚ -->
  <view class="list-overlay {{showList ? 'show' : ''}}" bindtap="onToggleList">
    <view class="list-panel" catchtap="">
      <view class="list-title">
        <text>å·²æŸ¥è¯¢åœ°ç‚¹</text>
        <view class="list-close" bindtap="onToggleList">âœ•</view>
      </view>
      <scroll-view scroll-y class="list-scroll">
        <view
          class="list-item {{activeMarkerIndex === index ? 'active' : ''}}"
          wx:for="{{results}}"
          wx:key="index"
          bindtap="onListItemTap"
          data-index="{{index}}"
        >
          <text class="list-item-name">{{item.ancient_name}}</text>
          <text class="list-item-arrow">â†’</text>
          <text class="list-item-modern">{{item.modern_name}}</text>
          <text class="list-item-province">{{item.province}}</text>
        </view>
      </scroll-view>
    </view>
  </view>
</view>
